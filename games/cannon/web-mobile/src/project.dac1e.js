window.__require=function e(t,o,n){function c(r,s){if(!o[r]){if(!t[r]){var a=r.split("/");if(a=a[a.length-1],!t[a]){var l="function"==typeof __require&&__require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+r+"'")}r=a}var u=o[r]={exports:{}};t[r][0].call(u.exports,function(e){return c(t[r][1][e]||e)},u,u.exports,e,t,o,n)}return o[r].exports}for(var i="function"==typeof __require&&__require,r=0;r<n.length;r++)c(n[r]);return c}({contact:[function(e,t,o){"use strict";cc._RF.push(t,"1367bPeHzVNjp/XH7hTH03V","contact"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},onDestroy:function(){},onBeginContact:function(e,t,o){0==t.tag&&0==o.tag&&(cc.log("onBeginContact..."),this.contactFunction(t,o))},onEndContact:function(e,t,o){},onPreSolve:function(e,t,o){},onPostSolve:function(e,t,o){},contactFunction:function(e,t){this.callBack&&this.callBack(e,t)},contactCallBack:function(e){this.callBack=e}}),cc._RF.pop()},{}],enemy:[function(e,t,o){"use strict";cc._RF.push(t,"ad054En1KJOLZn512ivh668","enemy"),cc.Class({extends:cc.Component,properties:{cloumnNode:cc.Node,cloumn:cc.Node,enemyGunImg:cc.Node,enemyBulletImg:cc.Node,enemyHeroImg:cc.Node,enemyDieParticle:cc.ParticleSystem},onLoad:function(){this._winSize=cc.winSize,this.enemyHeroImg.active=!1,this.enemyGunImg.active=!1},enemyAni:function(){this.enemyHeroImg.getComponent("spriteFrameAni").playAni("enemy",3,.1,!0)},setColumnHight:function(){var e=Math.floor(-250*Math.random())-100;this.cloumn.position=cc.v2(this._winSize.width/2+100,e)},comeOnAni:function(){var e=this;this.setColumnHight();var t=Math.floor(Math.random()*(this._winSize.width/4));this.cloumn.runAction(cc.sequence(cc.moveTo(1,cc.v2(t,this.cloumn.position.y)),cc.callFunc(function(){e.enemyHeroImg.active=!0,e.enemyGunImg.active=!0,e.enemyAni()},this)))},enemyMove:function(){var e=this;this.enemyHeroImg.active=!1,this.enemyGunImg.active=!1,this.cloumn.runAction(cc.sequence(cc.moveTo(1,cc.v2(-this._winSize.width/2-100,this.cloumn.position.y)),cc.callFunc(function(){e.callBack&&e.callBack()})))},enemyBulletWorldPos:function(){return this.cloumn.convertToWorldSpaceAR(cc.v2(this.enemyGunImg.position))},setGunAngle:function(e){this.enemyGunImg.angle=e},gunAni:function(e){var t=this,o=this.enemyBulletImg.position;this.enemyBulletImg.runAction(cc.sequence(cc.moveTo(.3,cc.v2(e,0)),cc.callFunc(function(){t.hitHeroCallBack&&t.hitHeroCallBack(),t.enemyBulletImg.position=o})))},enemyDie:function(){this.enemyDieParticle.node.active=!0,this.enemyDieParticle.stopSystem(),this.enemyDieParticle.resetSystem(),this.enemyGunImg.active=!1,this.enemyHeroImg.active=!1},playSound:function(e,t){cc.loader.loadRes(e,cc.AudioClip,function(e,o){if(!e)cc.audioEngine.playEffect(o,t)})},finishCallBack:function(e){this.callBack=e},hitHeroCallBack:function(e){this.hitHeroCallBack=e},update:function(e){}}),cc._RF.pop()},{}],gamePlay:[function(e,t,o){"use strict";cc._RF.push(t,"4c4566dFrtM45OFiHh2+1AC","gamePlay"),cc.Class({extends:cc.Component,properties:{bgImg:cc.Node,sunImg:cc.Node,moonImg:cc.Node,floorParent:cc.Node,farHouseImg0:cc.Node,farHouseImg1:cc.Node,nearHouseImg0:cc.Node,nearHouseImg1:cc.Node,farFloorImg0:cc.Node,farFloorImg1:cc.Node,nearFloorImg0:cc.Node,nearFloorImg1:cc.Node,scoreText:cc.Label,heroNode:cc.Node,shootLineImg:cc.Node,myBulletImg:cc.Node,myHeroImg:cc.Node,myGunImg:cc.Node,shieldImg:cc.Node,bloodBar:cc.ProgressBar,heroDieParticle:cc.ParticleSystem,endLayer:cc.Node,bestScoreText:cc.Label,allScoreText:cc.Label,myBulletPrefab:{default:[],type:cc.Prefab},enemyPrefab:cc.Prefab},onLoad:function(){this._winSize=cc.winSize,this._canShooting=!0,this._canContact=!0,this._curScore=0,this._heroBloodValue=100,cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().gravity=cc.v2(0,-640),this.randStyle=Math.floor(100*Math.random())%3,cc.sys.localStorage.setItem("gunHeroBgStyle",this.randStyle),this.heroType=parseInt(cc.sys.localStorage.getItem("gunHeroType"))||0,this.setImgTexture("imageRes/line"+this.heroType,this.shootLineImg),this.setImgTexture("imageRes/gun"+this.heroType,this.myGunImg),this.setImgTexture("bg/bgImg"+this.randStyle,this.bgImg),2==this.randStyle?(this.sunImg.active=!1,this.moonImg.active=!0):(this.moonImg.active=!1,this.sunImg.active=!0,this.setImgTexture("imageRes/sun"+this.randStyle,this.sunImg)),this.setImgTexture("imageRes/house"+this.randStyle,this.farHouseImg0),this.setImgTexture("imageRes/house"+this.randStyle,this.farHouseImg1),this.setImgTexture("imageRes/houshSmall"+this.randStyle,this.nearHouseImg0),this.setImgTexture("imageRes/houshSmall"+this.randStyle,this.nearHouseImg1),this.setImgTexture("imageRes/floor"+this.randStyle,this.farFloorImg0),this.setImgTexture("imageRes/floor"+this.randStyle,this.farFloorImg1),this.setImgTexture("imageRes/gameFloor"+this.randStyle,this.nearFloorImg0),this.setImgTexture("imageRes/gameFloor"+this.randStyle,this.nearFloorImg1),this.nearFloorImg0.zIndex=5,this.nearFloorImg1.zIndex=5,this.scoreText.string="0",this.node.on(cc.Node.EventType.TOUCH_START,this.onEventStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onEventMove,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onEventCancel,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onEventEnd,this),this.yunAni(),this.createEnemy(),this.myHeroAni(!1),this._enemyNode.enemyAni(),this.shieldImg.getComponent("spriteFrameAni").playAni("shield",4,.1,!0)},yunAni:function(){for(var e=this,t=-this._winSize.width/2,o=function(){var o=Math.floor(100*Math.random())%3,n=Math.random()*(1*e._winSize.height/6)+2*e._winSize.height/8;t=t+150*Math.random()+150;var c=new cc.Node,i=c.addComponent(cc.Sprite);c.parent=e.floorParent,c.position=cc.v2(t,n),e.setImgTexture("imageRes/yun"+e.randStyle+"_"+o,i),c.runAction(cc.repeatForever(cc.sequence(cc.moveBy(1,cc.v2(-20,0)),cc.callFunc(function(){c.position.x<-e._winSize.width/2-100&&(c.position=cc.v2(e._winSize.width/2+100,c.position.y))}))))};t<this._winSize.width/2;)o()},createEnemy:function(){var e=this,t=cc.instantiate(this.enemyPrefab);t.position=cc.v2(0,-110),t.parent=this.floorParent,this._enemyNode=t.getComponent("enemy"),this._enemyNode.comeOnAni(),this._enemyNode.finishCallBack(function(){e._canContact=!0,e._canShooting=!0,t.removeFromParent(),t=null,e.createEnemy()}),this._enemyNode.hitHeroCallBack(function(){e._heroBloodValue=e._heroBloodValue-25,e._heroBloodValue<=0?(e.playSound("sound/heroDie",!1),e._heroBloodValue=0,e.myHeroDie(),e.gameOver()):(e.playSound("sound/enemyDie",!1),e.setBloodValue(),e.myGunImg.angle=0,e._canShooting=!0,e._canContact=!0)})},updateGunAngle:function(){this.shootLineImg.active=!0,this._curAngle=0,this.gunSchedule=function(){this._curAngle<90&&(this._curAngle+=1,this.myGunImg.angle=this._curAngle)},this.schedule(this.gunSchedule,.03)},stopGunAngle:function(){this.unschedule(this.gunSchedule),this.shootLineImg.active=!1},setBulletBody:function(){var e=this;this.bulletNode=cc.instantiate(this.myBulletPrefab[this.heroType]),this.bulletNode.parent=this.myGunImg,this.bulletNode.position=this.myBulletImg.position,this.bulletNode.getComponent("contact").contactCallBack(function(t,o){if(e._canContact){e.playSound("sound/openFire",!1),e._canContact=!1,e.unschedule(e.bulletfun);var n=t.node.group,c=o.node.group;("heroBullet"==n&&"floor"==c||"floor"==n&&"heroBullet"==c)&&e.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){e.bulletNode.removeFromParent(),e.bulletNode=null,e.enemyOpenFire()}))),("heroBullet"==n&&"column"==c||"column"==n&&"heroBullet"==c)&&e.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){e.bulletNode.removeFromParent(),e.bulletNode=null,e.enemyOpenFire()}))),("heroBullet"==n&&"enemy"==c||"enemy"==n&&"heroBullet"==c)&&(e._enemyNode.enemyDie(),e.node.runAction(cc.sequence(cc.delayTime(.3),cc.callFunc(function(){e.bulletNode.removeFromParent(),e.bulletNode=null,e.updateScore(),e.myHeroAni(!0),e.myHeroScaleAni(),e.gameBgAni(),e._enemyNode.enemyMove()}))))}})},myHeroAni:function(e){e?this.myHeroImg.getComponent("spriteFrameAni").playAni("heroRun"+this.heroType+"_",5,.06,!0):this.myHeroImg.getComponent("spriteFrameAni").playAni("heroWait"+this.heroType+"_",3,.1,!0)},myHeroScaleAni:function(){this.heroNode.runAction(cc.sequence(cc.scaleTo(1,1.1),cc.scaleTo(1,1)))},gameBgAni:function(){var e=this,t=this.farHouseImg0.width;this.farHouseImg0.runAction(cc.sequence(cc.moveBy(2,cc.v2(-200,0)),cc.delayTime(.1),cc.callFunc(function(){e.farHouseImg0.position.x<=-t-e._winSize.width/2&&(e.farHouseImg0.position=cc.v2(e.farHouseImg1.position.x+t,e.farHouseImg0.position.y)),e.myHeroAni(!1)}))),this.farHouseImg1.runAction(cc.sequence(cc.moveBy(2,cc.v2(-200,0)),cc.delayTime(.1),cc.callFunc(function(){e.farHouseImg1.position.x<=-t-e._winSize.width/2&&(e.farHouseImg1.position=cc.v2(e.farHouseImg0.position.x+t,e.farHouseImg1.position.y))})));var o=this.nearHouseImg0.width;this.nearHouseImg0.runAction(cc.sequence(cc.moveBy(2,cc.v2(-300,0)),cc.delayTime(.1),cc.callFunc(function(){e.nearHouseImg0.position.x<=-o-e._winSize.width/2&&(e.nearHouseImg0.position=cc.v2(e.nearHouseImg1.position.x+o,e.nearHouseImg0.position.y))}))),this.nearHouseImg1.runAction(cc.sequence(cc.moveBy(2,cc.v2(-300,0)),cc.delayTime(.1),cc.callFunc(function(){e.nearHouseImg1.position.x<=-o-e._winSize.width/2&&(e.nearHouseImg1.position=cc.v2(e.nearHouseImg0.position.x+o,e.nearHouseImg1.position.y))})));var n=this.farFloorImg0.width;this.farFloorImg0.runAction(cc.sequence(cc.moveBy(2,cc.v2(-400,0)),cc.delayTime(.1),cc.callFunc(function(){e.farFloorImg0.position.x<=-n-e._winSize.width/2&&(e.farFloorImg0.position=cc.v2(e.farFloorImg1.position.x+n,e.farFloorImg0.position.y))}))),this.farFloorImg1.runAction(cc.sequence(cc.moveBy(2,cc.v2(-400,0)),cc.delayTime(.1),cc.callFunc(function(){e.farFloorImg1.position.x<=-n-e._winSize.width/2&&(e.farFloorImg1.position=cc.v2(e.farFloorImg0.position.x+n,e.farFloorImg1.position.y))})));for(var c=this.nearFloorImg0.width,i=function(t){e.nearFloorImg0.runAction(cc.sequence(cc.delayTime(.02*t),cc.callFunc(function(){t%9==0&&e.playSound("sound/walk",!1);var o=e.nearFloorImg0.position.x-4;e.nearFloorImg0.position=cc.v2(o,e.nearFloorImg0.position.y);var n=e.nearFloorImg1.position.x-4;e.nearFloorImg1.position=cc.v2(n,e.nearFloorImg1.position.y),o<=-c-e._winSize.width/2&&(e.nearFloorImg0.position=cc.v2(e.nearFloorImg1.position.x+c,e.nearFloorImg0.position.y)),n<=-c-e._winSize.width/2&&(e.nearFloorImg1.position=cc.v2(e.nearFloorImg0.position.x+c,e.nearFloorImg1.position.y))})))},r=0;r<100;r++)i(r)},enemyOpenFire:function(){var e=this._enemyNode.enemyBulletWorldPos(),t=this.myHeroImg.parent.convertToWorldSpaceAR(cc.v2(this.myHeroImg.position.x,this.myHeroImg.position.y+30)),o=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y),c=180*Math.atan2(n,o)/Math.PI;this._enemyNode.setGunAngle(c);var i=Math.sqrt(Math.pow(o,2)+Math.pow(n,2));this._enemyNode.gunAni(i),this.playSound("sound/enemyBullet",!1)},setBloodValue:function(){var e=this._heroBloodValue/100;this.shieldImg.opacity=Math.floor(255*e),this.bloodBar.progress=e},myHeroDie:function(){this.heroDieParticle.node.active=!0,this.heroDieParticle.stopSystem(),this.heroDieParticle.resetSystem(),this.heroNode.active=!1},gameOver:function(){var e=this;this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){e.endLayer.active=!0;var t=parseInt(cc.sys.localStorage.getItem("gunBestScore"))||0;e._curScore>t?(e.bestScoreText.string=e._curScore,cc.sys.localStorage.setItem("gunBestScore",e._curScore)):e.bestScoreText.string=t,e.allScoreText.string=e._curScore})))},exitCallBack:function(e,t){this.playSound("sound/click",!1),cc.director.preloadScene("start",function(){cc.director.loadScene("start")})},refreshCallBack:function(e,t){this.playSound("sound/click",!1),cc.director.preloadScene("playScene",function(){cc.director.loadScene("playScene")})},onEventStart:function(e){this._canShooting&&(cc.log("onEventStart"),this.updateGunAngle())},onEventMove:function(e){cc.log("onEventMove")},onEventEnd:function(e){if(this._canShooting){cc.log("onEventEnd"),this.playSound("sound/heroBullet",!1),this._canShooting=!1,this.stopGunAngle(),this.setBulletBody(this.myBulletImg);var t=5e3;1==this.heroType&&(t=7e3);var o=t*Math.tan(Math.abs(this._curAngle)*(Math.PI/180));this.bulletNode.getComponent(cc.RigidBody).applyForceToCenter(cc.v2(t,o));var n=this.bulletNode.position,c=n;this.bulletfun=function(){var e=(n=this.bulletNode.position).x-c.x,t=0,o=0;n.y<c.y?(t=n.y-c.y,o=180*Math.atan2(t,e)/Math.PI):(t=c.y-n.y,o=-1*Math.atan2(t,e)*180/Math.PI),c=n,this.bulletNode.angle=o},this.schedule(this.bulletfun,.1)}},onEventCancel:function(e){this.onEventEnd(e)},updateScore:function(){this._curScore+=1,this.scoreText.string=this._curScore,this.playSound("sound/addScore",!1)},setImgTexture:function(e,t){cc.loader.loadRes(e,cc.SpriteFrame,function(e,o){e?cc.error(e.message||e):t.getComponent(cc.Sprite).spriteFrame=o}.bind(this))},playSound:function(e,t){cc.loader.loadRes(e,cc.AudioClip,function(e,o){if(!e)cc.audioEngine.playEffect(o,t)})},update:function(e){}}),cc._RF.pop()},{}],gameStart:[function(e,t,o){"use strict";cc._RF.push(t,"466d1vNKlpKv4G2GnT19Wo3","gameStart"),cc.Class({extends:cc.Component,properties:{heroBtn:{default:[],type:cc.Button}},onLoad:function(){for(var e=parseInt(cc.sys.localStorage.getItem("gunHeroType")||0),t=0;t<4;t++){this.heroBtn[t].interactable=!0}this.heroBtn[e].interactable=!1},startBtnCallBack:function(e,t){this.playSound("sound/click",!1),cc.log("startBtnCallBack"),cc.director.preloadScene("playScene",function(){cc.director.loadScene("playScene")})},selectHeroCallBack:function(e,t){this.playSound("sound/select",!1);for(var o=parseInt(t),n=0;n<4;n++){this.heroBtn[n].interactable=!0}this.heroBtn[o].interactable=!1,cc.sys.localStorage.setItem("gunHeroType",o)},playSound:function(e,t){cc.loader.loadRes(e,cc.AudioClip,function(e,o){if(!e)cc.audioEngine.playEffect(o,t)})},update:function(e){}}),cc._RF.pop()},{}],spriteFrameAni:[function(e,t,o){"use strict";cc._RF.push(t,"61bb3OkGGpI1anzjzSa9dcH","spriteFrameAni"),cc.Class({extends:cc.Component,properties:{bigImg:cc.SpriteAtlas},onLoad:function(){},playAni:function(e,t,o,n){var c=this;this.stopAni(),this.node.getComponent(cc.Sprite).spriteFrame=this.bigImg.getSpriteFrame(e+0);for(var i=[],r=function(t){i.push(cc.delayTime(o)),i.push(cc.callFunc(function(){c.node.getComponent(cc.Sprite).spriteFrame=c.bigImg.getSpriteFrame(e+t)}))},s=0;s<t;s++)r(s);n?this.node.runAction(cc.repeatForever(cc.sequence(i))):this.node.runAction(cc.sequence(i))},stopAni:function(){this.node.stopAllActions()},onDestroy:function(){}}),cc._RF.pop()},{}],"use_v2.1-2.2.1_cc.Toggle_event":[function(e,t,o){"use strict";cc._RF.push(t,"63ddbPOuQpHOaS77i1zajyB","use_v2.1-2.2.1_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_isChecked=!0),cc._RF.pop()},{}]},{},["contact","enemy","gamePlay","gameStart","spriteFrameAni","use_v2.1-2.2.1_cc.Toggle_event"]);