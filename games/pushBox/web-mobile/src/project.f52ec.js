window.__require=function t(e,i,a){function s(l,o){if(!i[l]){if(!e[l]){var n=l.split("/");if(n=n[n.length-1],!e[n]){var r="function"==typeof __require&&__require;if(!o&&r)return r(n,!0);if(c)return c(n,!0);throw new Error("Cannot find module '"+l+"'")}l=n}var h=i[l]={exports:{}};e[l][0].call(h.exports,function(t){return s(e[l][1][t]||t)},h,h.exports,t,e,i,a)}return i[l].exports}for(var c="function"==typeof __require&&__require,l=0;l<a.length;l++)s(a[l]);return s}({gameLayer:[function(t,e,i){"use strict";cc._RF.push(e,"8bdddCze2RD97IUN7F/EblH","gameLayer");var a=0,s=1,c=2,l=3,o=4,n=5,r=6,h="Texture/sound/button",u="Texture/sound/gamewin",v="Texture/sound/move",m="Texture/sound/pushbox",p="Texture/sound/wrong";cc.Class({extends:cc.Component,properties:{bg:cc.Node,menuLayer:cc.Node,levelLayer:cc.Node,gameLayer:cc.Node,gameControlLayer:cc.Node,gameOverLayer:cc.Node,startBtn:cc.Node,titleImg:cc.Node,iconImg:cc.Node,loadingTxt:cc.Node,levelScroll:cc.Node,levelContent:cc.Node,levelTxt:cc.Node,curNum:cc.Node,bestNum:cc.Node,itemImgAtlas:cc.SpriteAtlas,levelImgAtlas:cc.SpriteAtlas,levelItemPrefab:cc.Prefab},onLoad:function(){this.curLayer=0,this.clearGameData(),this.initData(),this.menuLayer.active=!0,this.levelLayer.active=!1,this.gameLayer.active=!1,this.gameOverLayer.active=!1,this.loadingTxt.active=!0,this.startBtn.getComponent(cc.Button).interactable=!1,this.fitNode(this.bg),this.menuLayerAni()},fitNode:function(t){var e=cc.view.getCanvasSize(),i=e.width/e.height;this.bg.height=.5625/i*1280},initData:function(){this.boxWidth=90,this.boxHeight=90,this.allWidth=720,this.allHeight=1280,this.allRow=8,this.allCol=8,this.allLevelCount=0,this.allLevelConfig={},cc.loader.loadRes("levelConfig.json",function(t,e){t?console.log(t):(this.allLevelConfig=e.json.level,this.allLevelCount=e.json.levelCount,this.loadingTxt.active=!1,this.startBtn.getComponent(cc.Button).interactable=!0,this.createLavelItem())}.bind(this)),this.tabLevel=[]},createLavelItem:function(){for(var t=this,e=function(e){t.selectLevelCallBack(e)},i=0;i<this.allLevelCount;i++){var a=cc.instantiate(this.levelItemPrefab);a.parent=this.levelScroll;var s=a.getComponent("levelItem");s.levelFunc(e),this.tabLevel.push(s)}this.levelContent.height=135*Math.ceil(this.allLevelCount/5)+20},updateLevelInfo:function(){for(var t=parseInt(cc.sys.localStorage.getItem("finishLevel")||0),e=1;e<=this.allLevelCount;e++)if(e<=t){var i=parseInt(cc.sys.localStorage.getItem("levelStar"+e)||0);this.tabLevel[e-1].showStar(!0,i,this.levelImgAtlas,e)}else e==t+1?this.tabLevel[e-1].showStar(!0,0,this.levelImgAtlas,e):this.tabLevel[e-1].showStar(!1,0,this.levelImgAtlas,e)},menuLayerAni:function(){this.startBtn.scale=1,this.startBtn.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(.6,1.5),cc.scaleTo(.6,1))))},startBtnCallBack:function(t,e){var i=this;1!=this.curLayer&&(this.curLayer=1,this.playSound(h),this.menuLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){i.startBtn.stopAllActions(),i.startBtn.scale=1,i.menuLayer.opacity=255,i.menuLayer.active=!1}))),this.levelLayer.active=!0,this.levelLayer.opacity=0,this.levelLayer.runAction(cc.sequence(cc.delayTime(.1),cc.fadeIn(.1),cc.callFunc(function(){i.updateLevelInfo()}))))},levelBackCallBack:function(t,e){0!=this.curLayer&&(this.playSound(h),this.curLayer=0,this.levelLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){this.levelLayer.opacity=255,this.levelLayer.active=!1},this))),this.menuLayer.active=!0,this.menuLayer.opacity=0,this.menuLayer.runAction(cc.sequence(cc.delayTime(.1),cc.fadeIn(.1))),this.menuLayerAni())},selectLevelCallBack:function(t){this.curLevel=t,2!=this.curLayer&&(this.playSound(h),this.curLayer=2,this.levelLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){this.levelLayer.opacity=255,this.levelLayer.active=!1},this))),this.gameLayer.active=!0,this.gameLayer.opacity=0,this.gameLayer.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){this.createLevelLayer(t)},this),cc.fadeIn(.1))))},backLevelCallBack:function(t,e){this.clearGameData(),1!=this.curLayer&&(this.playSound(h),this.curLayer=1,this.gameLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){this.gameLayer.opacity=255,this.gameLayer.active=!1},this))),this.levelLayer.active=!0,this.levelLayer.opacity=0,this.levelLayer.runAction(cc.sequence(cc.fadeIn(.1),cc.callFunc(function(){this.updateLevelInfo()},this))))},nextLevelCallBack:function(t,e){this.playSound(h),this.gameOverLayer.active=!1,this.curLevel=this.curLevel+1,this.curLevel>this.allLevelCount?this.backLevelCallBack():this.createLevelLayer(this.curLevel)},refreshCallBack:function(t,e){this.playSound(h),this.gameLayer.stopAllActions(),this.clearGameData(),this.createLevelLayer(this.curLevel)},revokeCallBack:function(t,e){},createLevelLayer:function(t){this.gameControlLayer.removeAllChildren(),this.setLevel(),this.setCurNum(),this.setBestNum();var e=this.allLevelConfig[t].content;this.allRow=this.allLevelConfig[t].allRow,this.allCol=this.allLevelConfig[t].allCol,this.heroRow=this.allLevelConfig[t].heroRow,this.heroCol=this.allLevelConfig[t].heroCol,this.boxW=this.allWidth/this.allCol,this.boxH=this.boxW;var i=-this.allWidth/2+this.boxW/2,a=this.allWidth/2-this.boxW/2,s=0;s=(this.allRow,this.allCol,(this.allRow-this.allCol)*this.boxH/2),this.landArrays=[],this.palace=[];for(var c=0;c<this.allRow;c++)this.landArrays[c]=[],this.palace[c]=[];for(var l=0;l<this.allRow;l++)for(var o=0;o<this.allCol;o++){var n=i+this.boxW*o,h=a-this.boxH*l+s,u=this.createBoxItem(l,o,e[l*this.allCol+o],cc.v2(n,h));this.landArrays[l][o]=u,u.width=this.boxW,u.height=this.boxH}this.setLandFrame(this.heroRow,this.heroCol,r)},createBoxItem:function(t,e,i,c){var l=new cc.Node,o=l.addComponent(cc.Sprite),r=l.addComponent(cc.Button);return o.spriteFrame=this.itemImgAtlas.getSpriteFrame("p"+i),l.parent=this.gameControlLayer,l.position=c,i==s?(l.name="wall_"+t+"_"+e,l.attr({_type_:i})):i==a?(l.name="none_"+t+"_"+e,l.attr({_type_:i})):(l.name="land_"+t+"_"+e,l.attr({_type_:i}),l.attr({_row_:t}),l.attr({_col_:e}),r.interactable=!0,r.target=l,r.node.on("click",this.clickCallBack,this),i==n&&(this.finishBoxCount+=1)),this.palace[t][e]=i,l},clickCallBack:function(t,e){var i=t.target;this.minPath=this.allCol*this.allRow+1,this.bestMap=[],this.end={},this.end.row=i._row_,this.end.col=i._col_,this.start={},this.start.row=this.heroRow,this.start.col=this.heroCol;var a=this.palace[this.end.row][this.end.col];if(a==c||a==l)if(this.getPath(this.start,0,[]),this.minPath<=this.allCol*this.allRow){cc.log("\u4ece\u8d77\u70b9[",this.start.row,",",this.start.col,"]\u5230\u7ec8\u70b9[",this.end.row,",",this.end.col,"]\u6700\u77ed\u8def\u5f84\u957f\u4e3a\uff1a",this.minPath,"\u6700\u77ed\u8def\u5f84\u4e3a\uff1a"),cc.log("[",this.start.row,",",this.start.col,"]");for(var h=0;h<this.bestMap.length;h++)cc.log("=>[",this.bestMap[h].row,",",this.bestMap[h].col,"]");this.bestMap.unshift(this.start),this.runHero()}else console.log("\u627e\u4e0d\u5230\u8def\u5f84\u5230\u8fbe");else if(a==o||a==n){var u=this.end.row-this.start.row,v=this.end.col-this.start.col;if(Math.abs(u)+Math.abs(v)==1){var g=this.end.row+u,d=this.end.col+v,L=this.palace[g][d];if(L&&L!=s&&L!=o&&L!=n)this.playSound(m),this.setLandFrame(this.start.row,this.start.col,this.palace[this.start.row][this.start.col]),this.palace[this.end.row][this.end.col]==n?(this.palace[this.end.row][this.end.col]=l,this.finishBoxCount-=1):this.palace[this.end.row][this.end.col]=c,this.setLandFrame(this.end.row,this.end.col,r),this.palace[g][d]==l?(this.palace[g][d]=n,this.finishBoxCount+=1):this.palace[g][d]=o,this.setLandFrame(g,d,this.palace[g][d]),this.curStepNum+=1,this.setCurNum(),this.heroRow=this.end.row,this.heroCol=this.end.col,this.checkGameOver();else this.playSound(p),console.log("\u524d\u65b9\u6709\u969c\u788d\u7269")}else this.playSound(p),console.log("\u76ee\u6807\u70b9\u9519\u8bef")}},getPath:function(t,e,i){if(t.row==this.end.row&&t.col==this.end.col&&e<this.minPath){this.bestMap=[];for(var a=0;a<i.length;a++)this.bestMap.push(i[a]);this.minPath=e,i=[]}for(var o=t.row-1;o<=t.row+1;o++)for(var n=t.col-1;n<=t.col+1;n++)if(!(o<0||o>=this.allRow||n<0||n>=this.allCol)&&(o==t.row||n==t.col)&&this.palace[o][n]&&(this.palace[o][n]==c||this.palace[o][n]==l)){var r=this.palace[o][n];this.palace[o][n]=s;var h={};h.row=o,h.col=n,i.push(h),this.getPath(h,e+1,i),this.palace[o][n]=r,i.pop()}},runHero:function(){var t=this;this.setLandEnable(!1);for(var e=[],i=function(i){e.push(cc.delayTime(.1)),e.push(cc.callFunc(function(){var t=this.bestMap[i];this.setLandFrame(t.row,t.col,r);var e=this.bestMap[i-1];this.setLandFrame(e.row,e.col,this.palace[e.row][e.col]),this.curStepNum+=1,this.playSound(v),this.setCurNum()},t))},a=1;a<this.bestMap.length;a++)i(a);e.push(cc.callFunc(function(){this.heroRow=this.end.row,this.heroCol=this.end.col,this.setLandEnable(!0)},this)),e.length>=2?this.gameLayer.runAction(cc.sequence(e)):this.setLandEnable(!0)},setLandEnable:function(t){for(var e=0;e<this.allRow;e++)for(var i=0;i<this.allCol;i++){var a=this.landArrays[e][i];a&&(a.getComponent(cc.Button).interactable=t)}},setLandFrame:function(t,e,i){var a=this.landArrays[t][e];a&&(a.getComponent(cc.Sprite).spriteFrame=this.itemImgAtlas.getSpriteFrame("p"+i),a.width=this.boxW,a.height=this.boxH)},checkGameOver:function(){var t=this.allLevelConfig[this.curLevel].allBox;if(this.finishBoxCount==t){this.gameOverLayer.active=!0,this.gameOverLayer.opacity=1,this.gameOverLayer.runAction(cc.sequence(cc.delayTime(.5),cc.fadeIn(.1)));var e=parseInt(cc.sys.localStorage.getItem("finishLevel")||0);this.curLevel>e&&cc.sys.localStorage.setItem("finishLevel",this.curLevel),cc.sys.localStorage.setItem("levelStar"+this.curLevel,3);var i=parseInt(cc.sys.localStorage.getItem("levelBest"+this.curLevel)||0);(this.curStepNum<i||0==i)&&cc.sys.localStorage.setItem("levelBest"+this.curLevel,this.curStepNum),this.playSound(u),this.clearGameData()}},setLevel:function(){this.levelTxt.getComponent(cc.Label).string=this.curLevel},setCurNum:function(){this.curNum.getComponent(cc.Label).string=this.curStepNum},setBestNum:function(){var t=cc.sys.localStorage.getItem("levelBest"+this.curLevel)||"--";this.bestNum.getComponent(cc.Label).string=t},clearGameData:function(){this.finishBoxCount=0,this.curStepNum=0,this.curStepNum=0},playSound:function(t){cc.loader.loadRes(t,cc.AudioClip,function(t,e){cc.audioEngine.playEffect(e,!1)})},start:function(){}}),cc._RF.pop()},{}],levelItem:[function(t,e,i){"use strict";cc._RF.push(e,"ae408IqDF5DFo8na+52hGjt","levelItem"),cc.Class({extends:cc.Component,properties:{starImg:cc.Node,itemBg:cc.Node,levelTxt:cc.Node},onLoad:function(){},showStar:function(t,e,i,a){this.itemBg.attr({_level_:a}),t?(this.itemBg.getComponent(cc.Sprite).spriteFrame=i.getSpriteFrame("pass_bg"),this.starImg.active=!0,this.starImg.getComponent(cc.Sprite).spriteFrame=i.getSpriteFrame("point"+e),this.levelTxt.opacity=255,this.itemBg.getComponent(cc.Button).interactable=!0):(this.itemBg.getComponent(cc.Sprite).spriteFrame=i.getSpriteFrame("lock"),this.starImg.active=!1,this.levelTxt.opacity=125,this.itemBg.getComponent(cc.Button).interactable=!1),this.levelTxt.getComponent(cc.Label).string=a},btnCallBack:function(t,e){this._callfunc&&this._callfunc(this.itemBg._level_)},levelFunc:function(t){this._callfunc=t}}),cc._RF.pop()},{}],"use_v2.1-2.2.1_cc.Toggle_event":[function(t,e,i){"use strict";cc._RF.push(e,"2cb70zkpYhKLbwPghDJlRIV","use_v2.1-2.2.1_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_isChecked=!0),cc._RF.pop()},{}]},{},["gameLayer","levelItem","use_v2.1-2.2.1_cc.Toggle_event"]);